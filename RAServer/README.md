
Red alert(RA) is a service monitor.  It grabs metric data from dataSource such as graphite or ganglia, to check whether current metric values are normal by some configurable rules. Alarm messages are reported by smtp or curl.

# Introduction
RA is composed of two parts, RA web and server. RA web is used to CRUD the alarms rules, for example, to adjust the alarm threshold. 
RA server is used to connect to datasource and send alarm messages if neccessary.
Heartbeats from RA server to RA web are used to tell the current server state
RA web and server must be disposed at the same machine/filesystem(In fact, currently RA only supports local filesystem, but you can implement your filesystem interface under the "contrib" directory).
The configuration files use sqlite files to prevent concurrent modifition problems. 
If some one changes or adds alarm rules, RA web will tell RA server to reload the full copy of the configuration from a specified directory.
The communication protocol between RA web and RA server is HTTP.

## How to build Red Alert Server ##
# Installation
RA server is based on linux(64bit), which is centos on our production environment. But it also can runs on ubuntu.
Because RA is built by scons, so you must install scons before compilation. On ubuntu, install scons by apt-get install.

```bash
sudo apt-get install scons
```

RA depends on rrd, sqlite3, etc. So the depends should be installed before compiling RA server
```bash
sudo apt-get install librrd-dev crypto libssl-dev libldap-dev libidn11-dev libglib2.0-dev libsqlite3-dev
```

RA depends on curl, jansson, libevent, log4cplus. 
And the four modules are distributed under the "deps" directory. Compile these dependences by run compileDepend.sh
```bash
sh compileDepend.sh
```
The libraries and header files are generated under the "_external" directory.

# Compilation
```bash
# Build all components of RA.
scons -j <jobs>

# Build and run all unit tests.
scons -j <jobs> test

# package.
scons -j <jobs> package

# Generate a tar.gz file with all RA binaries.
# Path of the tar.gz file will be (depends on the build mode):
# build/debug/red_alert.tar.gz or
# build/release/red_alert.tar.gz

# Build and run unit tests in a folder.
scons <folder>
```

## How to start Red Alert Server ##

After a successful build, an executable binary is generated at path `build/release64/bin/red_alert_app`
(or `build/debug64/bin/red_alert_app`). `red_alert_app` accepts the following command line options(Of course, you should set LD_LIBRARY_PATH before running red_alert_app):

```bash
usage: red_alert_app
    -p, --port <port number> (required)
    -c, --confDir <absolute path to ra config> (required)
    -l, --logConf <absolute path to log config>
    -d, --workDir <absolute path to work directory>
    -f, --fileSys <file system>
```

Examples of configuration files can be found at [`bootstrap.json`](conf/bootstrap.json) and [`ra_log.conf`](conf/ra_log.conf).

### Development Environment ###

In a development environment, it's recommended to use the shell script [`start_dev.sh`](start_dev.sh) under
the root of code repos to start Red Alert for test.

### Production Environment ###

A tar.gz file with all Red Alert binaries (generated by `scons package`) is used to deploy Red Alert
in production environment. A shell script named [`red_alert.sh`](ra/app/red_alert.sh) is placed at
`usr/local/bin/red_alert.sh` in the tar.gz file. This script can be used to start a stand-alone
Red Alert process in production.

## Red Alert Documentation ##

- [Configurations](docs/ra-config.md)
- [Metric Fetcher API](docs/metric-fetcher.md)
- [Database Schema](docs/database-schema.md)
