# -*- mode: python -*-

import os

Import('env')
env = env.Clone()

pwd = Dir('.')
config_command = """
cd '%s' && ./configure --enable-static --enable-shared --prefix='%s' CC='%s' CXXFLAGS='-g -fPIC'
""" % (pwd.abspath, env["install_path"], env["CC"])

build_command = "cd '%s' && touch * && make install" % (pwd.abspath,)

sources = [
    'mingw-log4cplus.spec',
    'log4cplus.pc.in',
    'Makefile.in',
    'tests/ostream_test/Makefile.am',
    'tests/ostream_test/CMakeLists.txt',
    'tests/ostream_test/main.cxx',
    'tests/ostream_test/expout',
    'tests/hierarchy_test.at',
    'tests/headers.at',
    'tests/fileappender_test/experr',
    'tests/fileappender_test/Makefile.am',
    'tests/fileappender_test/CMakeLists.txt',
    'tests/fileappender_test/main.cxx',
    'tests/loglog_test/experr',
    'tests/loglog_test/Makefile.am',
    'tests/loglog_test/CMakeLists.txt',
    'tests/loglog_test/main.cxx',
    'tests/loglog_test/expout',
    'tests/filter_test/log4cplus.properties.in',
    'tests/filter_test/Makefile.am',
    'tests/filter_test/CMakeLists.txt',
    'tests/filter_test/main.cxx',
    'tests/filter_test/expout',
    'tests/ostream_test.at',
    'tests/patternlayout_test/Makefile.am',
    'tests/patternlayout_test/CMakeLists.txt',
    'tests/patternlayout_test/main.cxx',
    'tests/customloglevel_test/Makefile.am',
    'tests/customloglevel_test/CMakeLists.txt',
    'tests/customloglevel_test/customloglevel.h',
    'tests/customloglevel_test/main.cxx',
    'tests/customloglevel_test/expout',
    'tests/customloglevel_test/func.cxx',
    'tests/customloglevel_test/customloglevel.cxx',
    'tests/priority_test/Makefile.am',
    'tests/priority_test/CMakeLists.txt',
    'tests/priority_test/main.cxx',
    'tests/priority_test/expout',
    'tests/priority_test/func.cxx',
    'tests/thread_test.at',
    'tests/local.at',
    'tests/Makefile.am',
    'tests/CMakeLists.txt',
    'tests/thread_test/Makefile.am',
    'tests/thread_test/CMakeLists.txt',
    'tests/thread_test/main.cxx',
    'tests/socket_test/Makefile.am',
    'tests/socket_test/CMakeLists.txt',
    'tests/socket_test/main.cxx',
    'tests/socket_test/run_test',
    'tests/ndc_test/Makefile.am',
    'tests/ndc_test/CMakeLists.txt',
    'tests/ndc_test/main.cxx',
    'tests/ndc_test/expout',
    'tests/performance_test.at',
    'tests/priority_test.at',
    'tests/propertyconfig_test.at',
    'tests/customloglevel_test.at',
    'tests/appender_test/Makefile.am',
    'tests/appender_test/CMakeLists.txt',
    'tests/appender_test/main.cxx',
    'tests/appender_test/expout',
    'tests/ndc_test.at',
    'tests/hierarchy_test/Makefile.am',
    'tests/hierarchy_test/CMakeLists.txt',
    'tests/hierarchy_test/main.cxx',
    'tests/hierarchy_test/expout',
    'tests/performance_test/log4cplus.properties.in',
    'tests/performance_test/Makefile.am',
    'tests/performance_test/CMakeLists.txt',
    'tests/performance_test/main.cxx',
    'tests/performance_test/README',
    'tests/fileappender_test.at',
    'tests/patternlayout_test.at',
    'tests/timeformat_test.at',
    'tests/propertyconfig_test/log4cplus.properties.in',
    'tests/propertyconfig_test/Makefile.am',
    'tests/propertyconfig_test/CMakeLists.txt',
    'tests/propertyconfig_test/main.cxx',
    'tests/propertyconfig_test/log4cplus.tail.properties.in',
    'tests/configandwatch_test/log4cplus.properties.in',
    'tests/configandwatch_test/Makefile.am',
    'tests/configandwatch_test/CMakeLists.txt',
    'tests/configandwatch_test/main.cxx',
    'tests/configandwatch_test/log4cplus.properties.1',
    'tests/configandwatch_test/log4cplus.properties.2',
    'tests/configure.m4',
    'tests/configandwatch_test.at',
    'tests/filter_test.at',
    'tests/testsuite',
    'tests/appender_test.at',
    'tests/testsuite.at',
    'tests/loglog_test.at',
    'tests/timeformat_test/Makefile.am',
    'tests/timeformat_test/CMakeLists.txt',
    'tests/timeformat_test/main.cxx',
    'tests/timeformat_test/expout',
    'tests/atlocal.in',
    'm4/ax_gcc_var_attribute.m4',
    'm4/ax_declspec.m4',
    'm4/ax_append_flag.m4',
    'm4/ax_macro_function.m4',
    'm4/ax_python_devel.m4',
    'm4/ax_pthread.m4',
    'm4/ax_tls_support.m4',
    'm4/ax_cflags_gcc_option.m4',
    'm4/ax_cflags_warn_all.m4',
    'm4/ax_c_ifdef.m4',
    'm4/libtool.m4',
    'm4/ltversion.m4',
    'm4/lt~obsolete.m4',
    'm4/ax_macro_va_args.m4',
    'm4/ax_log4cplus_wrappers.m4',
    'm4/ax_swig_multi_module_support.m4',
    'm4/ax_gcc_func_attribute.m4',
    'm4/ax_gethostbyname_r.m4',
    'm4/ax_compiler_vendor.m4',
    'm4/ax_pkg_swig.m4',
    'm4/ax_cflags_sun_option.m4',
    'm4/ax_getaddrinfo.m4',
    'm4/ax_type_socklen_t.m4',
    'm4/ltsugar.m4',
    'm4/ax_cflags_aix_option.m4',
    'm4/ltoptions.m4',
    'm4/ax__sync.m4',
    'm4/pkg.m4',
    'INSTALL',
    'config.guess',
    'mkinstalldirs',
    'iOS/iOS.cmake',
    'iOS/ConfigureChecks.cmake',
    'iOS/scripts/cmake_ios_i386.sh',
    'iOS/scripts/cmake_ios_armv7.sh',
    'iOS/README.txt',
    'Log4CPlusUtils.cmake',
    'Makefile.am',
    'docs/latex-body.tex',
    'docs/log4cplus.pdf',
    'docs/doxygen.css',
    'docs/release.txt',
    'docs/webpage_header.html',
    'docs/latex-header.tex',
    'docs/doxygen.config',
    'docs/webpage_footer.html',
    'docs/webpage_doxygen.config',
    'docs/unicode.txt',
    'docs/log4cplus.ps',
    'docs/log4cplus.svg',
    'compile',
    'CMakeLists.txt',
    '.gitignore',
    'configure',
    'Log4CPlusCPack.cmake',
    'configure.ac',
    'ConfigureChecks.cmake',
    'AUTHORS',
    'acinclude.m4',
    'NEWS',
    'LICENSE',
    'TODO',
    'scripts/fix-timestamps.sh',
    'scripts/clean_cmake_files.bat',
    'scripts/build-pdf.pl',
    'scripts/autogen.sh',
    'scripts/prepare_dist_from_git.sh',
    'scripts/msvc10_to_msvc11.cmd',
    'scripts/update_copyrights.sh',
    'scripts/propagate-version.pl',
    'scripts/clean_cmake_files.sh',
    'scripts/doautoreconf.sh',
    'scripts/upload_to_wiki.pl',
    'scripts/msvc10_to_msvc12.cmd',
    '.travis.yml',
    'COPYING',
    'qt5debugappender/qt5debugappender.cxx',
    'qt5debugappender/Makefile.am',
    'qt5debugappender/CMakeLists.txt',
    'swig/Makefile.common.am',
    'swig/log4cplus.swg',
    'swig/logger.swg',
    'swig/loggingevent.swg',
    'swig/python/Makefile.am',
    'swig/configurator.swg',
    'swig/hierarchy.swg',
    'install-sh',
    'ar-lib',
    'src/loggingevent.cxx',
    'src/stringhelper.cxx',
    'src/hierarchylocker.cxx',
    'src/loglevel.cxx',
    'src/logger.cxx',
    'src/asyncappender.cxx',
    'src/socketbuffer.cxx',
    'src/socket-unix.cxx',
    'src/clfsappender.cxx',
    'src/socket.cxx',
    'src/cygwin-win32.cxx',
    'src/syslogappender.cxx',
    'src/win32consoleappender.cxx',
    'src/Makefile.am',
    'src/loggingmacros.cxx',
    'src/CMakeLists.txt',
    'src/factory.cxx',
    'src/lockfile.cxx',
    'src/configurator.cxx',
    'src/socketappender.cxx',
    'src/loglog.cxx',
    'src/filter.cxx',
    'src/global-init.cxx',
    'src/stringhelper-clocale.cxx',
    'src/stringhelper-cxxlocale.cxx',
    'src/property.cxx',
    'src/loggerimpl.cxx',
    'src/appenderattachableimpl.cxx',
    'src/pointer.cxx',
    'src/objectregistry.cxx',
    'src/msttsappender.cxx',
    'src/snprintf.cxx',
    'src/log4cplus.rc.in',
    'src/mdc.cxx',
    'src/patternlayout.cxx',
    'src/clogger.cxx',
    'src/env.cxx',
    'src/ndc.cxx',
    'src/socket-win32.cxx',
    'src/rootlogger.cxx',
    'src/connectorthread.cxx',
    'src/appender.cxx',
    'src/consoleappender.cxx',
    'src/logloguser.cxx',
    'src/layout.cxx',
    'src/cmake/Config.cmake.in',
    'src/log4judpappender.cxx',
    'src/fileappender.cxx',
    'src/win32debugappender.cxx',
    'src/timehelper.cxx',
    'src/hierarchy.cxx',
    'src/nteventlogappender.cxx',
    'src/queue.cxx',
    'src/threads.cxx',
    'src/sleep.cxx',
    'src/tls.cxx',
    'src/nullappender.cxx',
    'src/version.cxx',
    'src/fileinfo.cxx',
    'src/syncprims.cxx',
    'src/stringhelper-iconv.cxx',
    'cygport/log4cplus.cygport',
    'cygport/configure.ac-disable-__thread-keyword.patch',
    'cygport/configure.ac-relax-libtool-version.patch',
    'py-compile',
    'qt4debugappender/Makefile.am',
    'qt4debugappender/CMakeLists.txt',
    'qt4debugappender/qt4debugappender.cxx',
    'depcomp',
    'aclocal.m4',
    'ltmain.sh',
    'log4cplus.spec',
    'README.md',
    'android/scripts/cmake_android_x86.sh',
    'android/scripts/cmake_android_mips.sh',
    'android/scripts/cmake_android_neon.sh',
    'android/scripts/cmake_android.sh',
    'android/scripts/cmake_android_armeabi.sh',
    'android/android.toolchain.cmake',
    'config.sub',
    '.dir-locals.el',
    'msvc10/log4cplus.vcxproj',
    'msvc10/log4cplus_static.props',
    'msvc10/Qt4DebugAppender.vcxproj',
    'msvc10/tests/socket_test.vcxproj',
    'msvc10/tests/loglog_test.vcxproj.filters',
    'msvc10/tests/log4cplus_tests.props',
    'msvc10/tests/hierarchy_test.vcxproj',
    'msvc10/tests/customloglevel_test.vcxproj.filters',
    'msvc10/tests/socket_test.vcxproj.filters',
    'msvc10/tests/performance_test.vcxproj.filters',
    'msvc10/tests/ostream_test.vcxproj',
    'msvc10/tests/ostream_test.vcxproj.filters',
    'msvc10/tests/timeformat_test.vcxproj.filters',
    'msvc10/tests/ndc_test.vcxproj',
    'msvc10/tests/filter_test.vcxproj',
    'msvc10/tests/thread_test.vcxproj',
    'msvc10/tests/customloglevel_test.vcxproj',
    'msvc10/tests/thread_test.vcxproj.filters',
    'msvc10/tests/ndc_test.vcxproj.filters',
    'msvc10/tests/appender_test.vcxproj.filters',
    'msvc10/tests/patternlayout_test.vcxproj',
    'msvc10/tests/propertyconfig_test.vcxproj.filters',
    'msvc10/tests/loglog_test.vcxproj',
    'msvc10/tests/priority_test.vcxproj.filters',
    'msvc10/tests/configandwatch_test.vcxproj',
    'msvc10/tests/fileappender_test.vcxproj.filters',
    'msvc10/tests/fileappender_test.vcxproj',
    'msvc10/tests/configandwatch_test.vcxproj.filters',
    'msvc10/tests/hierarchy_test.vcxproj.filters',
    'msvc10/tests/priority_test.vcxproj',
    'msvc10/tests/propertyconfig_test.vcxproj',
    'msvc10/tests/patternlayout_test.vcxproj.filters',
    'msvc10/tests/performance_test.vcxproj',
    'msvc10/tests/filter_test.vcxproj.filters',
    'msvc10/tests/timeformat_test.vcxproj',
    'msvc10/tests/appender_test.vcxproj',
    'msvc10/log4cplus.props',
    'msvc10/log4cplus.sln',
    'msvc10/MSTTSAppender.vcxproj',
    'msvc10/log4cplusS.vcxproj.filters',
    'msvc10/MSTTSAppender.props',
    'msvc10/loggingserver.props',
    'msvc10/log4cplus_debug.props',
    'msvc10/loggingserver.vcxproj.filters',
    'msvc10/CLFSAppender.props',
    'msvc10/CLFSAppender.vcxproj',
    'msvc10/log4cplus_release.props',
    'msvc10/Qt4DebugAppender.props',
    'msvc10/log4cplus.vcxproj.filters',
    'msvc10/loggingserver.vcxproj',
    'msvc10/log4cplusS.vcxproj',
    'msvc10/Qt5DebugAppender.vcxproj',
    'msvc10/Qt5DebugAppender.props',
    'include/Makefile.in',
    'include/Makefile.am',
    'include/log4cplus/qt4debugappender.h',
    'include/log4cplus/version.h',
    'include/log4cplus/configurator.h',
    'include/log4cplus/qt5debugappender.h',
    'include/log4cplus/layout.h',
    'include/log4cplus/loglevel.h',
    'include/log4cplus/hierarchylocker.h',
    'include/log4cplus/config.hxx',
    'include/log4cplus/win32debugappender.h',
    'include/log4cplus/streams.h',
    'include/log4cplus/syslogappender.h',
    'include/log4cplus/tracelogger.h',
    'include/log4cplus/thread/syncprims-pub-impl.h',
    'include/log4cplus/thread/threads.h',
    'include/log4cplus/thread/impl/threads-impl.h',
    'include/log4cplus/thread/impl/syncprims-win32.h',
    'include/log4cplus/thread/impl/syncprims-impl.h',
    'include/log4cplus/thread/impl/syncprims-pthreads.h',
    'include/log4cplus/thread/impl/syncprims-pmsm.h',
    'include/log4cplus/thread/impl/syncprims-cxx11.h',
    'include/log4cplus/thread/impl/tls.h',
    'include/log4cplus/thread/syncprims.h',
    'include/log4cplus/log4judpappender.h',
    'include/log4cplus/asyncappender.h',
    'include/log4cplus/clogger.h',
    'include/log4cplus/tstring.h',
    'include/log4cplus/hierarchy.h',
    'include/log4cplus/fileappender.h',
    'include/log4cplus/loggingmacros.h',
    'include/log4cplus/logger.h',
    'include/log4cplus/config.h.cmake.in',
    'include/log4cplus/appender.h',
    'include/log4cplus/helpers/queue.h',
    'include/log4cplus/helpers/thread-config.h',
    'include/log4cplus/helpers/snprintf.h',
    'include/log4cplus/helpers/pointer.h',
    'include/log4cplus/helpers/property.h',
    'include/log4cplus/helpers/fileinfo.h',
    'include/log4cplus/helpers/appenderattachableimpl.h',
    'include/log4cplus/helpers/logloguser.h',
    'include/log4cplus/helpers/lockfile.h',
    'include/log4cplus/helpers/socket.h',
    'include/log4cplus/helpers/loglog.h',
    'include/log4cplus/helpers/connectorthread.h',
    'include/log4cplus/helpers/timehelper.h',
    'include/log4cplus/helpers/stringhelper.h',
    'include/log4cplus/helpers/socketbuffer.h',
    'include/log4cplus/helpers/sleep.h',
    'include/log4cplus/mdc.h',
    'include/log4cplus/config/macosx.h',
    'include/log4cplus/config/defines.hxx.in',
    'include/log4cplus/config/windowsh-inc.h',
    'include/log4cplus/config/win32.h',
    'include/log4cplus/tchar.h',
    'include/log4cplus/consoleappender.h',
    'include/log4cplus/clfsappender.h',
    'include/log4cplus/msttsappender.h',
    'include/log4cplus/internal/internal.h',
    'include/log4cplus/internal/env.h',
    'include/log4cplus/internal/cygwin-win32.h',
    'include/log4cplus/internal/socket.h',
    'include/log4cplus/nullappender.h',
    'include/log4cplus/nteventlogappender.h',
    'include/log4cplus/config.h.in',
    'include/log4cplus/fstreams.h',
    'include/log4cplus/boost/deviceappender.hxx',
    'include/log4cplus/win32consoleappender.h',
    'include/log4cplus/ndc.h',
    'include/log4cplus/spi/rootlogger.h',
    'include/log4cplus/spi/factory.h',
    'include/log4cplus/spi/loggerfactory.h',
    'include/log4cplus/spi/loggingevent.h',
    'include/log4cplus/spi/appenderattachable.h',
    'include/log4cplus/spi/objectregistry.h',
    'include/log4cplus/spi/filter.h',
    'include/log4cplus/spi/loggerimpl.h',
    'include/log4cplus/socketappender.h',
    'ChangeLog',
    'simpleserver/Makefile.in',
    'simpleserver/Makefile.am',
    'simpleserver/CMakeLists.txt',
    'simpleserver/loggingserver.cxx',
    '.gitattributes',
    'missing',
]

config = env.Command(target = ['Makefile', 'include/log4cplus/config.h', 'include/log4cplus/config/defines.hxx'],
                     source = sources, action = config_command)
liblog4cplus = env.Command(target = [os.path.join(env["install_path"], 'lib/liblog4cplus.a'),
                                     os.path.join(env["install_path"], 'lib/liblog4cplus.so'),
                                     os.path.join(env["install_path"], 'include/log4cplus/logger.h'),
                                     os.path.join(env["install_path"], 'include/log4cplus/config/defines.hxx')],
                           source = sources + [config], action = build_command)
Return('liblog4cplus')
